---
name: paw-discovery-mapping
description: Mapping activity skill for PAW Discovery workflow. Delegates codebase capability analysis to paw-code-research and formats findings into CapabilityMap.md.
---

# Discovery Mapping

> **Execution Context**: This skill runs **directly** in the PAW Discovery session, coordinating delegation to `paw-code-research` subagent.

Map existing codebase **features and capabilities** that could integrate with or support extracted themes. The goal is feature-level discovery—understanding what the codebase can already do—not cataloging implementation details.

## Purpose

Identify **major capabilities** at the feature level:
- What user-facing features exist?
- What workflows are already supported?
- What integrations or extensibility points exist?

The outcome may be negative (no useful correlations), but evaluation happens at the right level: features that could integrate with themes, not low-level implementation details like "controller exists" or "uses dependency injection."

## Capabilities

- Read Extraction.md to understand themes requiring capability mapping
- Formulate feature-focused research questions
- Delegate to `paw-code-research` via subagent
- Reformat findings into feature-level CapabilityMap.md
- Evaluate potential integration with extracted themes

## Research Question Formulation

### Focus Level

**DO focus on:**
- Major features and workflows ("What features exist for user onboarding?")
- Integration points ("What extension mechanisms exist?")
- Supported use cases ("What content types can the system process?")

**DON'T focus on:**
- Implementation patterns ("Does it use MVC?")
- Internal components ("What controllers exist?")
- Code structure ("Where are the services located?")

**Concrete examples from real output:**
- ✅ GOOD: "CAP-1: Server Dashboard with Real-Time Metrics" — describes what users see
- ✅ GOOD: "CAP-9: Query Plan Visualizer" — a complete feature users interact with
- ❌ BAD: "CAP-2: Subscription-Based Metrics Streaming" — implementation detail, not a feature
- ❌ BAD: "CAP-5: Server Configuration Detection" — internal mechanism

When you find an implementation pattern, ask: "What feature does this enable?" and document THAT.

### Input Analysis

Read Extraction.md and identify:
1. Features that might have existing implementations
2. User needs that existing features could address
3. Integration opportunities between themes and codebase
4. Capability gaps that would require net-new work

### Question Generation

For each theme area, ask feature-level questions:
- "What features exist that could support [theme]?"
- "Can the system already [capability implied by theme]?"
- "What would need to change to enable [theme]?"

### Example Questions

Given extracted themes about "document analysis" and "workflow automation":
- "What document formats can the system already process?"
- "Are there existing workflow features that could be extended?"
- "What integration points exist for adding new capabilities?"

NOT: "Where is the DocumentController?" or "What base classes exist?"

## Delegation to paw-code-research

### Invocation Pattern

Use the Task tool to spawn a subagent:

```
task(
  agent_type: "general-purpose",
  description: "Code research for Discovery mapping",
  prompt: "[research prompt below]"
)
```

### Subagent Prompt

Delegate with context emphasizing feature-level discovery:

```
Load the paw-code-research skill and research the codebase to answer these questions:

1. [Question 1]
2. [Question 2]
...

Context: This research supports a Discovery workflow analyzing [work title].

IMPORTANT: Focus on FEATURE-LEVEL capabilities, not implementation details.
- Good: "The system can process PDF documents via the document processor"
- Bad: "There's a DocumentProcessor class at src/processor.ts"

Document what the codebase CAN DO as features, not how it's structured internally.
Return findings with file:line references for verification, but describe capabilities at the feature level.
```

### Handling Research Results

When research completes:
1. Extract capability descriptions from findings
2. Preserve file:line references
3. Map capabilities to relevant extracted themes
4. Identify gaps (themes with no matching capabilities)

## CapabilityMap.md Artifact

Save to: `.paw/discovery/<work-id>/CapabilityMap.md`

### Template

```markdown
---
date: [ISO timestamp]
work_id: [work-id]
capability_count: [N]
research_source: CodeResearch.md (if generated by subagent)
related_themes: [count of themes with capability matches]
status: complete
---

# Capability Map: [Work Title]

## Summary

[2-3 sentences describing what the codebase can do at a feature level, relevant to extracted themes]

## Major Capabilities

### CAP-1: [Feature-Level Capability Name]
- **What it does**: [User-facing feature or workflow this enables]
- **How it could integrate**: [Potential connection to extracted themes]
- **Evidence**: `src/module.ts:45` (reference for verification)
- **Related Themes**: F1, N2 (references to Extraction.md)

### CAP-2: [Feature-Level Capability Name]
- **What it does**: [User-facing feature or workflow]
- **How it could integrate**: [Potential connection to themes, or "No clear integration path"]
- **Evidence**: `src/other.ts:10`
- **Related Themes**: F3, C1

...

## Integration Potential

| Theme | Existing Capability | Integration Assessment |
|-------|--------------------|-----------------------|
| F1: [Feature] | CAP-1 | Could extend existing feature |
| F2: [Feature] | - | Net-new work required |
| N1: [Need] | CAP-2 | Already supported |
| N2: [Need] | CAP-1, CAP-3 | Partial - gaps remain |

## Gaps (Net-New Work)

Themes with no existing capability to build on:

- **F2**: [Feature name] - No related capability in codebase
- **N3**: [Need name] - Would require new subsystem

## Notes

[Observations about integration opportunities or challenges that inform correlation/prioritization]
```

## Quality Threshold

Per SC-004 from spec: CapabilityMap.md should document **at least 3 existing capabilities** for any non-trivial codebase. If fewer found, note in artifact and verify research was thorough.

## Execution

### Desired End States

- Extraction.md read and themes understood
- Research questions formulated based on themes
- paw-code-research delegated with appropriate context
- Research findings reformatted into CapabilityMap.md
- Theme-capability relationships documented
- Gaps identified for themes with no matches

### Minimal Codebase Handling

If codebase is minimal (starter project, empty repo):
1. Document that few/no capabilities exist
2. Mark most themes as "Gap"
3. Note in summary that this is expected for new projects
4. Still produce valid CapabilityMap.md artifact

## Quality Checklist

- [ ] Extraction.md was read for theme context
- [ ] Research questions cover major theme areas
- [ ] paw-code-research delegation included proper context
- [ ] Capabilities have file:line references
- [ ] Related Themes links are valid (reference Extraction.md IDs)
- [ ] Theme Coverage table is complete
- [ ] Gaps section identifies themes without capabilities
- [ ] YAML frontmatter is valid with capability count

## Completion Response

Report to PAW Discovery agent:
- Artifact path: `.paw/discovery/<work-id>/CapabilityMap.md`
- Capability count
- Theme coverage summary (X full, Y partial, Z gaps)
- Ready for mapping review
