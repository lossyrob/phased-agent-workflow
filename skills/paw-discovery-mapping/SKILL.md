---
name: paw-discovery-mapping
description: Mapping activity skill for PAW Discovery workflow. Delegates codebase capability analysis to paw-code-research and formats findings into CapabilityMap.md.
---

# Discovery Mapping

> **Execution Context**: This skill runs **directly** in the PAW Discovery session, coordinating delegation to `paw-code-research` subagent.

Map existing codebase capabilities that may relate to extracted themes. Delegates actual codebase analysis to `paw-code-research` skill and reformats findings into a capability inventory.

## Capabilities

- Read Extraction.md to understand themes requiring capability mapping
- Formulate research questions based on extracted themes
- Delegate to `paw-code-research` via subagent
- Reformat research findings into CapabilityMap.md
- Link capabilities to relevant extracted themes

## Research Question Formulation

### Input Analysis

Read Extraction.md and identify:
1. Features that might have existing implementations
2. User needs that existing features address
3. Constraints that affect capability scope
4. Technology areas implied by themes

### Question Generation

For each relevant area, generate questions like:
- "What existing features handle [theme area]?"
- "Where is [functionality type] implemented?"
- "What modules relate to [domain area]?"

### Example Questions

Given extracted themes about "user authentication" and "session management":
- "What authentication mechanisms exist in the codebase?"
- "Where are session handling components located?"
- "What patterns are used for user identity management?"

## Delegation to paw-code-research

### Subagent Prompt

Delegate with context:

```
Research the codebase to answer these questions about existing capabilities:

1. [Question 1]
2. [Question 2]
...

Context: This research supports a Discovery workflow analyzing [work title].
The goal is to inventory existing capabilities that relate to proposed themes.

Focus on documenting WHAT EXISTS, not recommendations or improvements.
Return findings with file:line references.
```

### Handling Research Results

When research completes:
1. Extract capability descriptions from findings
2. Preserve file:line references
3. Map capabilities to relevant extracted themes
4. Identify gaps (themes with no matching capabilities)

## CapabilityMap.md Artifact

Save to: `.paw/discovery/<work-id>/CapabilityMap.md`

### Template

```markdown
---
date: [ISO timestamp]
work_id: [work-id]
capability_count: [N]
research_source: CodeResearch.md (if generated by subagent)
related_themes: [count of themes with capability matches]
status: complete
---

# Capability Map: [Work Title]

## Summary

[2-3 sentences describing the codebase capability landscape relevant to extracted themes]

## Capabilities

### CAP-1: [Capability Name]
- **Description**: [What this capability does]
- **Location**: `src/module.ts:45-120`
- **Related Themes**: F1, N2 (references to Extraction.md)
- **Notes**: [Any relevant context]

### CAP-2: [Capability Name]
- **Description**: [What this capability does]
- **Location**: `src/other.ts:10-50`
- **Related Themes**: F3, C1
- **Notes**: [Any relevant context]

...

## Theme Coverage

| Theme | Related Capabilities | Coverage |
|-------|---------------------|----------|
| F1: [Feature] | CAP-1, CAP-3 | Partial |
| F2: [Feature] | - | Gap |
| N1: [Need] | CAP-2 | Full |
| C1: [Constraint] | CAP-2 | Full |

## Gaps

Themes with no matching codebase capabilities (net-new work needed):

- **F2**: [Feature name] - No existing implementation found
- **N3**: [Need name] - Requires new capability

## Notes

[Any observations about the capability landscape that inform correlation/prioritization]
```

## Quality Threshold

Per SC-004 from spec: CapabilityMap.md should document **at least 3 existing capabilities** for any non-trivial codebase. If fewer found, note in artifact and verify research was thorough.

## Execution

### Desired End States

- Extraction.md read and themes understood
- Research questions formulated based on themes
- paw-code-research delegated with appropriate context
- Research findings reformatted into CapabilityMap.md
- Theme-capability relationships documented
- Gaps identified for themes with no matches

### Minimal Codebase Handling

If codebase is minimal (starter project, empty repo):
1. Document that few/no capabilities exist
2. Mark most themes as "Gap"
3. Note in summary that this is expected for new projects
4. Still produce valid CapabilityMap.md artifact

## Quality Checklist

- [ ] Extraction.md was read for theme context
- [ ] Research questions cover major theme areas
- [ ] paw-code-research delegation included proper context
- [ ] Capabilities have file:line references
- [ ] Related Themes links are valid (reference Extraction.md IDs)
- [ ] Theme Coverage table is complete
- [ ] Gaps section identifies themes without capabilities
- [ ] YAML frontmatter is valid with capability count

## Completion Response

Report to PAW Discovery agent:
- Artifact path: `.paw/discovery/<work-id>/CapabilityMap.md`
- Capability count
- Theme coverage summary (X full, Y partial, Z gaps)
- Ready for mapping review
